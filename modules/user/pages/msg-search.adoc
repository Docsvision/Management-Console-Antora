= Поиск сообщений карточки

Данный виджет предназначен для получения списка входящих сообщений по обработке указанной карточки. Виджет может использоваться для диагностики проблемных карточек.

[#widget]
== Виджет поиска

.Текстовый виджет "Поиск входящих сообщений карточки"
image::search-text-dash.png[Текстовый виджет "Поиск входящих сообщений карточки"]

include::partial$excerpts.adoc[tags=contains]
. Строка для указания идентификатора карточки.
. Таблица с указанием результатов поиска. В первом столбце указывается _Состояние_ найденной карточки, во втором -- _Количество сообщений_.
+
На виджете отображается количество сообщений в каждом состоянии: _Обработано_, _Не обработано_, _Ошибка_, _Блокировано_. Количество сообщений в состоянии _Блокировано_ означает сообщения, имеющие блокировку, но не количество самих блокировок.

Виджет выводит информацию по идентификатору карточки. Каждому идентификатору соответствует карточка сообщения, в которой содержится список входящих сообщений по указанной карточке. Каждое входящие имеет уникальный идентификатор RowID и состояние State, содержащиеся в карточке сообщения.

Полная информация по найденной карточке доступна на странице _Сообщения карточки_.

.В таблице со списком сообщений могут отображаться следующие сообщения:
* `Карточка с идентификатором .... не найдена`, если карточка не найдена в системе.
* Число сообщений = 0 в каждой строке таблицы, если карточка найдена, но не найдены сообщения.
* `Сообщения не поддерживаются` если введен идентификатор карточки, для которой не может быть создана карточка сообщений.

[#page]
== Страница "Сообщения карточки"

.Страница "Сообщения карточки"
image::search-text-page.png[Страница "Сообщения карточки"]

Попасть на эту страницу можно только из виджета _Поиск входящих сообщений карточки_. Страница содержит информацию по всем входящим и исходящим сообщениям, выбранной карточки. Данные на странице будут обновлены только при обновлении страницы.

.Страница состоит из нескольких элементов:
Заголовок и вкладки::
В верхней части страницы отображается заголовок страницы и вкладки _Входящие сообщения_ и _Исходящие сообщения_. В зависимости от выбранной вкладки можно посмотреть информацию о входящих или исходящих сообщениях карточки.
+
Вкладки организованы следующим образом:
+
Область "Текущая карточка":::
В центральной области отображается карточка, для которой выводится список входящих и исходящих сообщений, а также исходных (область _Зависит от_ слева) или дочерние карточки (область _Подчинённые_). Текущей карточкой является карточка, ID которой был введён в поле виджета _Поиск входящих сообщений карточки_.
+
.Область "Текущая карточка"содержит:
* ID карточки -- идентификатор карточки в системе {dv}.
* Вид карточки -- понятный для человека вид карточки в системе {dv}.
+
include::partial$parameters.adoc[tags=digest]
+
* Соединение -- подключенный экземпляр соединения соответствующего типа (например, соединение типа Docsvision).
+
Область "Зависит от":::
В области отображаются карточки, из которых была создана текущая карточка. Например, _Исходящий_, из которого было создана группа заданий или группа заданий, из которой было создано задание на исполнение.
+
Исходные карточки выводятся в виде дайджеста. Если исходные карточки отсутствуют, область остаётся пустой.
+
Область "Подчинённые":::
В области отображаются подчинённые карточки, созданные из текущей карточки. Подчинённые карточки выводятся в виде дайджеста, их может быть несколько. Если подчинённые карточки отсутствуют, область остаётся пустой.

Область "Сообщения":::
В центральной области, под данными текущей карточки, отображаются все _Входящие_ или _Исходящие_ сообщения (в зависимости от вкладки) для текущей карточки.
+
.У каждого входящего сообщения есть набор параметров, часть из которых выводится в данной области:
include::partial$parameters.adoc[tags=cr-date]
// tag::state[]
* _Состояние_ -- состояние обработки сообщения. Сообщение может быть заблокировано в состоянии _Не обработано_, _Ошибка_. В этом случае через запятую с состоянием выводится слово _блокировка_. _Доступно только для входящих сообщений._
// end::state[]
+
При нажатии на строку сообщения, содержащую _Ошибки_ и/или _Блокировки_ открывается страница xref:block-error-log.adoc["Ошибки и блокировки"].
+
include::partial$parameters.adoc[tags=service]
+
include::partial$parameters.adoc[tags=msg-type]
+
include::partial$parameters.adoc[tags=info]
+
include::partial$parameters.adoc[tags=delayed-send]
+
include::partial$parameters.adoc[tags=act-date]

//При нажатии на строку области _Зависит от_ или _Подчиненные_ данные изменяются. В области _Текущая карточка_ отображается подробная информация о выбранной карточке, а в областях _Зависит от_ и _Подчиненные_ отображаются зависимые карточки. Для области _Зависит от_ -- карточки, от которых зависит текущая. Для области _Подчиненные_ -- карточки, которые зависят от выбранной _Текущей карточки_.
//
//.Пример изменения данных в зависимости от выбранной карточки
//****
//.Если в виджете был указан ID карточки группы заданий:
//- В области _Текущая карточка_ будет отображаться информация о карточке группы заданий.
//- В области _Зависит от_ -- входящий документ, из которого была создана группа заданий.
//- В области _Подчиненные_ -- задания на исполнения, сформированные группой заданий.
//
//.После нажатия на одно из заданий на исполнение:
//- В области _Текущая карточка_ будет отображаться информация о задании на исполнение 1.
//- В области _Зависит от_ -- группа заданий, из которой было создано задание на исполнение.
//- В области _Подчиненные_ -- подчиненные задания данного задания на исполнение.
//****

[#graph]
== Графическая реализация

image::widgetsOfWSMessagesOfCardAsGraph.png[Виджет Поиск входящих сообщений карточки (графический)]

include::partial$excerpts.adoc[tags=page]

Виджет содержит следующие элементы:

* заголовок с названием виджета, датой последнего обновления отображаемой информации и кнопкой обновления;

&gt; Данные автоматически обновляются с периодом 30 секунд.

* поле для выбора подключения к {dv}, из которого будут загружаться данные;

* поле для ввода идентификатора карточки, по которой нужно отображать статистику;

* гистограмму, на которой представлено количественное соотношение сообщений с разными состояниями обработки: Обработано, Не обработано, Ошибок и Блокировано (количество сообщений с блокировкой). При щелчке по столбцу будет выполнен переход к странице xref:msg-search.adoc[Поиск сообщений карточки]. ==В требовании на страницу нет фильтров (отменены)==

== Использование виджета

. Выберите xref:connections.adoc[подключение] к {dv}, из которого будут загружаться данные.

. В поле *Идентификатор карточки* введите идентификатор карточки, для которой нужна статистика обработки сообщений, нажмите кнопку *Найти*. В графиках отобразится статистка обработки сообщений карточки.

. Для перехода к xref:msg-search.adoc[Поиск сообщений карточки], содержащей полную информацию об обработке сообщений по данной карточке, щелкните по любому столбцу гистограммы.

Если у пользователя возникает проблема с карточкой _Задания_, администратор может проанализировать карточку при помощи виджета.

. Администратор должен получить ID проблемного задания из {wc} или {wincl}.
. Перейти в консоль управления, ввести ID в поле ввода данного виджета, чтобы получить сведения о сообщениях.
. Наличие сообщений в состоянии *_Обработано_* может говорить о том, что карточка начала обрабатываться даже если далее есть ошибки или блокировки.
. Наличие сообщений в состоянии *_Не обработано_* может говорить о том, что логика карточки _Задания_ возможно была еще не до конца выполнена, в связи с чем пользователю не приходит задание.
. Наличие сообщений в состоянии *_Ошибка_* говорит о том, что некоторые события не смогли быть корректно обработаны, в связи с чем у пользователя возникли сложности.
. Чтобы решить проблему, администратор должен будет перейти на страницу со списком входящих сообщений по этой карточке, а затем открыть страницу _Сообщений карточки_, на ней вкладку _Входящих сообщений карточки_.
. На вкладке будут отображены все сообщения карточки, включая _Ошибки и блокировки_.
. Наличие блокировок говорит о том, что часть сообщений были заблокированы внешними событиями. Заблокированы могут быть сообщения в состоянии _Не обработано_ и _Ошибка_.
. При блокировке процесс останавливается. Чтобы процесс возобновился, необходимо открыть страницу _Сообщений карточки_, на ней вкладку _Входящих сообщений карточки_. Затем перейти на страницу _Ошибок и блокировок_ и снять все блокировки.
. После разрешения ошибок входящее сообщение, ожидающее обработку может изменить свой статус один раз: из _Не обработано_ в _Ошибку_ или в _Обработано_.
+
CAUTION: Сообщение в состоянии *_Ошибка_*, не поменяет статус и все равно будет отображаться.