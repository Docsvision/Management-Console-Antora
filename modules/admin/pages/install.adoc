= Установка и первоначальная настройка {of-mc}

== Состав установочного комплекта

. Пакет установки {of-mc}: `{dv} 5 ManagementConsole.msi`.

== Установка {of-mc}

Инсталлятор установит одновременно {wac} и Хранилище (сервис) настроек. Установка должна выполняться на одной машине, установка на разные серверы не поддерживается.

.Чтобы установить {mc}:
. Откройте пакет установки `{dv} 5 ManagementConsole.msi`.
+
Пользователь, выполняющий установку, получит xref:provide-access.adoc[доступ] к программе {cns} (будет добавлен в группы *{wacs-g}* и *{wacss-g}*).
+
.Установка {of-mc}
image::install-hello.png[Установка {of-mc}]
+
. Нажмите *Далее*, ознакомьтесь с условиями лицензионного соглашения. Подтвердите, что вы согласны с лицензионным соглашением и нажмите *Далее*.
+
.Лицензионное соглашение
image::install-license.png[Лицензионное соглашение]
+
[#components]
. Выберите необходимые компоненты {of-mc}.
+
.Выбор устанавливаемых компонентов
image::install-components.png[Выбор устанавливаемых компонентов]
+
****
Базовые компоненты::
Основные компоненты {of-mc} и сервиса настроек, предоставляющие базовую функциональность.

Компоненты внешнего API::
Компоненты сервиса внешнего REST API Консоли.
//tag::api[]
Данный сервис предоставляет возможность получения сообщений и списка сообщений из системы {dv}.
//end::api[]
****
+
. При необходимости выберите место установки {of-mc}.
+
.Выбор расположения установки
image::install-location.png[Выбор расположения установки]
+
. На следующем шаге будет предложено указать настройки {of-mc}.
+
.Настройки {of-mc}
image::install-settings.png[Настройки {of-mc}]
+
****
Порт для {of-mc}::
Порт для доступа к {of-mc} из браузера по HTTP. По умолчанию `5100`.

Порт для Сервиса настроек::
Порт для подключения Консоли к _{to-sett-serv}_. По умолчанию `5200`.

Порт для Сервиса внешнего API {of-mc}::
Порт для доступа к внешнему REST API Консоли.
include::install.adoc[tags=api]
Указать порт можно только, если <<components,устанавливаются>> компоненты внешнего API.
+
Соединение между Консолью и сервисом устанавливается от имени авторизованного пользователя Консоли. Сервис также проверяет пользователя на принадлежность к группе *{wacs-g}*.
+
Сессия в Сервисе запускается от имени пользователя, запустившего Сервис или пул IIS.

Выберите тип сервера БД из списка::
Microsoft SQL Server или PostgreSQL в зависимости от используемой базы данных.

Строка подключения к базе данных для хранения настроек::
Строка подключения содержит адрес подключения к базе данных для хранения настроек. Вид строки подключения зависит от выбранной базы данных.
+
NOTE: Для _{of-sett-serv}_ рекомендуется использовать отдельную базу данных.
+
--
//tag::mssql[]
Для Microsoft SQL Server: `Data Source=Адрес-сервера-баз данных;Initial Catalog=Название-БД-{of-sm};Integrated Security=False;User ID=Имя-пользователя-БД;Password=Пароль-пользователя-БД`.

* `Адрес-сервера-баз данных` -- адрес сервера SQL для подключения к БД.
* `Название-БД-{of-sm}` -- псевдоним базы данных.
* `Integrated Security=False` -- SQL-аутентификация: `true` -- используется, `false` -- не используется.
* `Имя-пользователя-БД` -- учётная запись пользователя для подключения к БД.
* `Пароль-пользователя-БД` -- пароль учётной записи для подключения к БД.
* `TrustServerCertificate=True` -- параметр обязателен, только если используется Microsoft SQL без SSL. При использовании SSL данный параметр указывать ненужно.
//end::mssql[]
--
+
--
//tag::pgsql[]
Для PostgreSQL: `host=Адрес-сервера-баз данных;Port=SQL-порт;database=Название-БД-{of-sm};Username=Имя-пользователя-БД;Password=Пароль-пользователя-БД`.

* `Адрес-сервера-баз данных` -- адрес сервера SQL для подключения к БД.
* `SQL-порт` -- порт SQL-сервера.
* `Название-БД-{of-sm}` -- псевдоним базы данных.
* `Имя-пользователя-БД` -- учётная запись пользователя для подключения к БД.
* `Пароль-пользователя-БД` -- пароль учётной записи для подключения к БД.
//end::pgsql[]
--
****
+
include::workerservice:admin:page$install.adoc[tags=confirm]
+
.Продолжить установку или вернуться на предыдущий шаг
image::install-confirm.png[Продолжить установку или вернуться на предыдущий шаг]
+
include::workerservice:admin:page$install.adoc[tags=finish]

.После установки на сервер будет добавлены две локальные группы Windows:
. *{wacs-g}* -- пользователи, входящие в эту группу, имеют право работать с Консолью управления {dv}.
. *{wacss-g}* -- пользователи, входящие в эту группу, имеют право менять настройки в _{sett-serv}_.
+
//tag::nets[]
{wac} по умолчанию запускает {wacss} под учётной записью Network Service, которая включается в группы *{wacss-g}* и *{wacs-g}* автоматически.
//end::nets[]
Чтобы предоставить доступ к _Сервису настроек_ другим пользователям, выполните инструкцию в пункте xref:provide-access.adoc[].


== Настройка {of-mc}

Установка создаёт файл в формате JSON с настройками {of-mc} по умолчанию для BackOffice.
В JSON файле содержатся: имена типов реализаций подключаемых к Службе {ws}, настройки их сопоставления, роли обработки задач BackOffice, а также настройки самой Службы {ws} (включая очереди, фабрики и прочие).

Установка приносит настройки, которые не зависят от машины где развертываемся.

== Удаление {of-mc}

Чтобы удалить {mc}, запустите инсталлятор в режиме удаления.

Созданные группы и службы будут удалены, _{sett-serv}_ станет недоступно.
